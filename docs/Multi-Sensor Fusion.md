# Multi-Sensor Fusion

## Basic Principle

多传感器融合的基本原理类似于人类大脑对环境信息的综合处理过程。人类对外界环境的感知是通过将眼睛、耳朵、鼻子和四肢等感官（各种传感器）所探测的信息传输至大脑（信息融合中心），并与先验知识（数据库）进行综合，以便对其周围的环境和正在发生的事件做出快速准确地评估。

1）分布式。先对各个独立传感器所获得的原始数据进行局部处理，然后再将结果送 入信息融合中心进行智能优化组合来获得最终的结果。分布式对通信带宽的需求低、 计算速度快、可靠性和延续性好，但跟踪的精度却远没有集中式高。

 2）集中式。集中式将各传感器获得的原始数据直接送至中央处理器进行融合处理， 可以实现实时融合。其数据处理的精度高，算法灵活，缺点是对处理器的要求高，可靠性较低，数据量大，故难于实现。

 3）混合式。混合式多传感器信息融合框架中，部分传感器采用集中式融合方式，剩 余的传感器采用分布式融合方式。混合式融合框架具有较强的适应能力，兼顾了集中 式融合和分布式的优点，稳定性强。混合式融合方式的结构比前两种融合方式的结构 复杂，这样就加大了通信和计算上的代价。

## Prerequisites

我们需要对这些传感器**统一坐标系和时钟**，目的就是为了实现**三同一不同**：同一个目标在同一个时刻出现在不同类别的传感器的同一个世界坐标处。 

**统一时钟**：

**软同步方法：**GPS时间戳的时间同步方法，这个需要看传感的硬件是否支持该种方法，如果支持则传感器给出的数据包会有全局的时间戳，这些时间戳以GPS为基准，这样就使用了相同的时钟，而非各自传感器的时钟了。

但是还有一个问题，不同传感器的数据频率是不同的，如lidar为10Hz，camera为25/30Hz，那不同传感器之间的数据还是存在延迟，如下图所示。虽然可以通过找相邻时间戳的方法找到最近帧，但是如果两个时间戳差距较大，障碍物又在移动，最终会导致**较大的同步误差**。

**硬同步方法：**这种方法可以缓解查找时间戳造成的误差现象。该方法可以以激光雷达作为触发其它传感器的源头，当激光雷达转到某个角度时，才触发该角度的摄像头，这可以大大减少时间差的问题。这套时间同步方案可以做到硬件中，这样可以大大**降低同步误差，提高数据对齐效果**。

**统一坐标系**

统一坐标系有两步，**一是运动补偿，二是传感器标定**。

**运动补偿**主要针对长周期的传感器，在收发信号的时间间隔内与障碍物发生了相对运动。

**传感器标定**分为内参标定和外参标定，内参标定，解决的是单独的每个传感器与世界坐标系间的变换；外参标定是在世界坐标系下，解决的不同传感器间的变换。传感器外参校准依赖于传感器的精确内参校准。

## ADAS Sensor

- 相机：对目标的颜色和纹理比较敏感，可以完成目标分类、检测、分割、识别等任务，但是不能得到精确的探测距离，而且易受光照、天气条件的影响。
- 激光雷达：可以获得目标精确的3D信息，检测范围也能够到达150米。对光照不敏感，晚上也可以正常工作。但是角分辨率大，目标稀疏，无法获得目标纹理，分类不准，而且在雨、雾、雪等恶劣天气中，性能会下降。对扬尘、水雾也比较敏感，易产生噪点。
- 雷达：可以提供精确的距离和速度信息，探测距离也比较远，可以全天候工作，但分辨率较低，无法提供物体高度信息。

### Camera

| ADAS Function    | Position          | Description |
| ---------------- | ----------------- | ----------- |
| 车道偏离预警LDW  | Front             |             |
| 前向碰撞预警FCW  | Front             |             |
| 交通标志识别TSR  | Front, Side       |             |
| 车道保持辅助LKA  | Front             |             |
| 行人碰撞预警PCW  | Front             |             |
| 盲点监测BSD      | Side              |             |
| 全景泊车SVP      | Front, Side, Back |             |
| 泊车辅助PA       | Back              |             |
| 驾驶员注意力监测 | Inside            |             |

### Millimeter wave radar

毫米波的波长介于厘米波和光波之间， 因此毫米波兼有微波制导和光电制导的优点：

1）同厘米波导引头相比，毫米波导引头具 有体积小、质量轻和空间分辨率高的特点；

2）与红外、激光等光学导引头相比，毫米波导引头穿透雾、烟、灰尘的能力强，传输距离远，具有全天候全天时的特点；

3）性能稳定，不受目标物体形状、颜色等干扰。毫米波雷达很好的弥补了如红外、激光、超声波、 摄像头等其他传感器在车载应用中所不具备的使用场景。

毫米波雷达的探测距离一 般在 150m-250m 之间，有的高性能毫米波雷达探测距离甚至能达到 300m，可以满足汽车在高速运动时探测较大范围的需求。与此同时，毫米波雷达的探测精度较高。

毫米波雷达应用于自适应巡航

 这些特性使得毫米波雷达能够监测到大范围内车辆的运行情况，同时对于前方车辆的速度、加速度、距离等信息的探测也更加精准，因此是自适应巡航（ACC）、自动紧急刹车(AEB) 的首选传感器。

### LIDAR

激光雷达性能精良，是无人驾驶的最佳技术路线。激光雷达相对于其他自动驾驶传感器具有非常优越的性能：

分辨率高。激光雷达可以获得极高的角度、距离和速度分辨率，这意味着激光雷达可以利用多普勒成像技术获得非常清晰的图像。

精度高。激光直线传播、方向性好、光束非常窄，弥散性非常低，因此激光雷达的精度很高。

抗有源干扰能力强。与微波、毫米波雷达易受自然界广泛存在的电磁波影响的情况不同，自然界中能对激光雷达起干扰作用的信号源不多，因此激光雷达抗有源干扰的能力很强。

|              | Camera | Millimeter wave radar | LIDAR          |
| ------------ | ------ | --------------------- | -------------- |
| Max distance | 50m    | 250m                  | 200m           |
| Precision    | normal | high                  | extremely high |
| Function     |        |                       |                |
| Advantage    |        |                       |                |
| Disadvantage |        |                       |                |

## Fusion

### Pre-Fusion

前融合算法：

1、只有一个感知的算法。对融合后的多维综合数据进行感知。

2、在原始层把数据都融合在一起，融合好的数据就好比是一个Super传感器，而且这个传感器不仅有能力可以看到红外线，还有能力可以看到摄像头或者RGB，也有能力看到LiDAR的三维信息，就好比是一双超级眼睛。在这双超级眼睛上面，开发自己的感知算法，最后会输出一个结果层的物体。

### Post-Fusion

后融合算法：

1、每个传感器各自独立处理生成的目标数据。

2、每个传感器都有自己独立的感知，比如激光雷达有激光雷达的感知，摄像头有摄像头的感知，毫米波雷达也会做出自己的感知。

3、当所有传感器完成目标数据生成后，再由主处理器进行数据融合。

## Tesla

特斯拉的完全自动驾驶硬件系统包括：

1）车身四周加装 8 个摄像头，能够测量 250 米范围内的物体；

 2）搭载 12 颗 超声波传感器，用以辅助侦测；

3）升级增强版的毫米波雷达，能够在恶劣天气下工作，也能探测到前方车辆；

4）汽车主板的性能是前款产品的 40 倍，大幅提升计算能力。